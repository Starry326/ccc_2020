<!DOCTYPE html>
<html>
    <head>
        <title>Scenario 1</title>
        <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-base.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
        <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-map.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
        <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-exports.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
        <script src="https://cdn.anychart.com/releases/8.7.1/js/anychart-ui.min.js?hcode=a0c21fc77e1449cc86299c5faa067dc4"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
        <script src="https://cdn.anychart.com/geodata/2.0.0/countries/australia/australia.js"></script>
        <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
        <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js"></script>
    </head>
    <body>
        <h1><a href="{{url_for('index')}}">COMP90024 Project 2</a></h1>
        <h2>Scenario 1</h2>
        <p>This story is about... </p>
        <p id="p1"></p>
        <div id="container1" style="width: 50vw; height: 80vh"></div>
        <p>
            The graph above shows the tweet distribution and the tweet to population ratio for each region in Australia.<br>
            The tweet to population ratio measures the number of tweets about {{keywords}} against the total population of each region.
        </p>

        <div id="container2"style="width: 90vw; height: 90vh"></div>
        <p>
            This bar chart illustrates the population of different age groups across Australia.
        </p>

        <script type="text/javascript">
            anychart.onDocumentReady(function() {
              // ------------------------ get results ------------------------
              var results = {{results|tojson}};
              var regions = {{regions|tojson}};

              // ------------------------ container1 ------------------------
              var tweet_data = [];
              var ratio_data = [];
              var total_tweets = 0;
              var total_population = 0;
              for (var region in results) {
                  var x, y1, y2;
                  if (region == "nsw") {
                      x = "AU.NS";
                  } else if (region == "qld") {
                      x = "AU.QL";
                  } else if (region == "sa") {
                      x = "AU.SA";
                  } else if (region == "tas") {
                      x = "AU.TS";
                  } else if (region == "vic") {
                      x ="AU.VI";
                  } else if (region == "wa") {
                      x = "AU.WA";
                  } else if (region == "act") {
                      x = "AU.CT";
                  } else if (region == "nt") {
                      x = "AU.NT";
                  } else {
                      console.log("No such region");
                      break;
                  }
                  y1 = results[region]["tweets_count"];
                  y2 = results[region]["tweets_count"] / results[region]["population_data"]["total_population"];

                  total_tweets += results[region]["tweets_count"];
                  total_population += results[region]["population_data"]["total_population"];
                  tweet_data.push([x, y1]);
                  ratio_data.push([x, y2]);
              }

              var stage = anychart.graphics.create("container1");

              var map = anychart.map();
              map.geoData(anychart.maps.australia);
              map.title("Tweet Distribution in Australia");
              map.choropleth(tweet_data);
              map.bounds(0, 0, "100%", "70%");
              map.container(stage);
              map.draw();

              var area = anychart.area();
              area.title("Tweet to Population Ratio");
              area.splineArea(ratio_data);
              area.bounds(0, "70%", "100%", "30%");
              area.container(stage);
              area.draw();
              // ------------------------ container2 ------------------------
              var rows = [];
              var age_groups = ["0-4", "5-9", "10-14", "15-19", "20-24",
                                "25-29", "30-34", "35-39", "40-44", "45-49",
                                "50-54", "55-59", "60-64", "65-69", "70-74",
                                "75-79", "80-84", "over85"];
              var region_names = {"nsw": "New South Wales", "qld": "Queensland",
                                  "sa": "South Australia", "tas": "Tasmania",
                                  "vic": "Victoria", "wa": "Western Australia",
                                  "act": "Australian Capital Territory",
                                  "nt": "Northern Territory"};

              for (var i = 0; i < age_groups.length; i++) {
                  var row = [age_groups[i]];
                  for (var j = 0; j < regions.length; j++) {
                      row.push(results[regions[j]]["population_data"][age_groups[i]] * results[regions[j]]["population_data"]["total_population"]);
                  }
                  rows.push(row);
              }
              var header = ["#"];
              for (var i = 0; i < regions.length; i++) {
                  header.push(region_names[regions[i]]);
              }
              var population_data = {
                  title: "Australia Population",
                  header: header,
                  rows: rows
              };
              var chart = anychart.column();
              chart.data(population_data);
              chart.animation(true);
              chart.xAxis().title("Region");
              chart.yAxis().title("Population");
              chart.hovered().labels(false);
              chart.legend()
                .enabled(true)
                .fontSize(13)
                .padding([0, 0, 20, 0]);
                chart.interactivity().hoverMode('single');

              chart.tooltip()
                .positionMode('point')
                .position('center-top')
                .anchor('center-bottom')
                .offsetX(0)
                .offsetY(5);
              chart.container('container2');
              chart.draw();
              // ------------------------ innerHTML ------------------------
              document.getElementById("p1").innerHTML = total_tweets+" tweets about "+{{keywords|tojson}}+" have been collected";
            });
        </script>
    </body>
</html>
